<html>
<head>
<title>Da Dart Board</title>
<script>
    const GRANBOARD_UUID = "442f1570-8a00-9a28-cbe1-e1d4212d53eb";

    let boardCharacteristic = undefined;

    async function connectToDartboard() {
        if (boardCharacteristic) {
            // Unregister the previous listener
            boardCharacteristic.removeEventListener("characteristicvaluechanged", onSegmentHit);
        }

        const board = await navigator.bluetooth.requestDevice({filters:[{services: [GRANBOARD_UUID]}]});
        if (!board.gatt.connected) {
            await board.gatt.connect();
        }

        const service = await board.gatt.getPrimaryService(GRANBOARD_UUID);

        // Find the characteristic that supports the notify property. That is the one that executes when
        // a dartboard segment is hit
        boardCharacteristic = (await service.getCharacteristics()).find(characteristic => characteristic.properties.notify);

        boardCharacteristic.addEventListener("characteristicvaluechanged", onSegmentHit);

        await boardCharacteristic.startNotifications();
    }

    async function onSegmentHit(event)
    {
        const a = event.target.value.getInt8(0);
        const b = event.target.value.getInt8(1);
        const c = event.target.value.getInt8(2);
        const d = event.target.value.getInt8(3);
        console.log(`Length: ${event.target.value.byteLength}, Values: ${a}-${b}-${c}-${d}`);
    }
</script>
</head>
<body>
<p>
<h3>Testing Dart Board Connection</h3>
</p>
<button onclick="connectToDartboard()">Connect to board</button>
<p>
</body>
</html>
