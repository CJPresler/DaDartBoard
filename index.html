<html>
<head>
<title>Da Dart Board</title>
<script>
    const GRANBOARD_UUID = "442f1570-8a00-9a28-cbe1-e1d4212d53eb";

    const SEGMENT_MAPPING = {
        ""
    }

    const SEGMENTS = 
    {
        // Bullseye
        CNT_BULL: 0,
        DBL_BULL: 1,
        // 1
        CNT_1: 2,
        DBL_1: 3,
        OTR_1: 4,
        TRP_1: 5,
        // 2
        CNT_2: 6,
        DBL_2: 7,
        OTR_2: 8,
        TRP_2: 9,
        // 3
        CNT_1: 2,
        DBL_1: 3,
        OTR_1: 4,
        TRP_1: 5,
    }

    let boardCharacteristic = undefined;

    async function connectToDartboard() {
        if (boardCharacteristic) {
            // Unregister the previous listener
            boardCharacteristic.removeEventListener("characteristicvaluechanged", onSegmentHit);
        }

        const board = await navigator.bluetooth.requestDevice({filters:[{services: [GRANBOARD_UUID]}]});
        if (!board.gatt.connected) {
            await board.gatt.connect();
        }

        const service = await board.gatt.getPrimaryService(GRANBOARD_UUID);

        // Find the characteristic that supports the notify property. That is the one that executes when
        // a dartboard segment is hit
        boardCharacteristic = (await service.getCharacteristics()).find(characteristic => characteristic.properties.notify);

        boardCharacteristic.addEventListener("characteristicvaluechanged", onSegmentHit);

        await boardCharacteristic.startNotifications();
    }

    async function onSegmentHit(event)
    {
        let segmentID = new Uint8Array(event.target.value.buffer).join("-")
        
        console.log(segmentID);
    }
</script>
</head>
<body>
<p>
<h3>Testing Dart Board Connection</h3>
</p>
<button onclick="connectToDartboard()">Connect to board</button>
<p>
</body>
</html>
